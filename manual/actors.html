<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Organization">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta itemprop="name" content="Quasar">
<meta itemprop="description" content="Lightweight threads, CSP and actors for the JVM">
<title>
  
    Quasar's Actor System - 
   Quasar
</title>
<!--<link rel="shortcut icon" href="/images/icons/loading_icon.png">-->
<link href="/quasar/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/quasar/css/pygments/jekyll-github.css"  rel="stylesheet" type="text/css">
<!-- comment out the next line to disable line numbers -->
<link href="/quasar/css/pygments/linenos.css"        rel="stylesheet" type="text/css">
<!-- <link href="/quasar/css/prettify/sunburst.css" rel="stylesheet" type="text/css"> -->
<link href="/quasar/css/site.css?now" rel="stylesheet" type="text/css">



</head>
<body>

<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
      </a>
      <a class="brand" href="/quasar/">Quasar</a>
      <div class="nav-collapse collapse">
        <ul class="nav">
          <li class="icon github"><a href="https://github.com/puniverse/quasar"><img src="/quasar/images/icons/github.png">View on Github</a></li>
          <li><a href="/quasar/javadoc/index.html">API</a> </li>
          <li class="icon bug"><a href="https://github.com/puniverse/quasar/issues/new"><img src="/quasar/images/icons/bug.png">File a bug</a></li>
          <!-- <li class="icon source"><a href="https://github.com/puniverse/pulsar/blob/master/CONTRIBUTING.md"><img src="/images/icons/source.png">Contribute</a> </li> -->
          <li class="icon talk"><a href="https://groups.google.com/forum/#!forum/quasar-pulsar-user"><img src="/quasar/images/icons/talk.png">Discuss</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


<div class="container-fluid">
  <div class="row-fluid">
    <div class="span3">
  <div class="well well-small sidebar-nav">
    <ul class="nav nav-list">
      
        <li class="nav-header">Getting Started</li>
        
          
          
            
          
          
          
        
          
          
            
          
          
          
            <li>
              <a  href="/quasar/getting-started.html">
                Getting Started
              </a>
              
            </li>
          
        
          
          
            
          
          
          
        
          
          
            
          
          
          
        
          
          
            
          
          
          
        
          
          
            
          
          
          
            <li>
              <a  href="/quasar/news.html">
                News
              </a>
              
            </li>
          
        
          
          
            
          
          
          
        
      
        <li class="nav-header">User Manual</li>
        
          
          
            
          
          
          
            <li>
              <a  href="/quasar/manual/core.html">
                Quasar Core
              </a>
              
            </li>
          
        
          
          
            
          
          
          
        
          
          
            
          
          
          
            <li>
              <a class="active" href="/quasar/manual/actors.html">
                Quasar's Actor System
              </a>
              
              <ul class="nav nav-list"><li></li><li><a href="#error-handling">Error&nbsp;Handling</a></li><li><a href="#registering-actors">Registering&nbsp;Actors</a></li><li><a href="#monitoring-actors">Monitoring&nbsp;Actors</a></li><li><a href="#behaviors">Behaviors</a></li><li><a href="#supervisors">Supervisors</a></li></ul>
              
            </li>
          
        
          
          
            
          
          
          
            <li>
              <a  href="/quasar/manual/records.html">
                Records
              </a>
              
            </li>
          
        
          
          
            
          
          
          
            <li>
              <a  href="/quasar/manual/cluster.html">
                Clustering
              </a>
              
            </li>
          
        
          
          
            
          
          
          
        
          
          
            
          
          
          
            <li>
              <a  href="/quasar/manual/examples.html">
                Examples
              </a>
              
            </li>
          
        
      
      <li class="divider"></li>
    </ul>
  </div>
</div>

    <div class="span8" id="content-container">

      <span class="edit-on-github">
  <a href="https://github.com/puniverse/quasar/edit/master/docs/manual/actors.md">Edit on Github</a>
</span>


      
      <div class="page-header">
        <h1>Quasar's Actor System
          
        </h1>
      </div>
      

      <div id="content">
<p>To use the terms we’ve learned so far, an <em>actor</em> is a strand that owns a single channel with some added lifecyce management and error handling. But this reductionist view of actors does them little justice. Actors are fundamental building blocks that are combined to build a fault-tolerant application. If you are familiar with Erlang, Quasar actors are just like Erlang&nbsp;processes.</p>

<p>An actor is a self-contained execution unit with well-defined inputs and outputs. Actors communicate with other actors (as well as regular program threads and fibers) by passing&nbsp;messages.</p>

<p class="alert alert-info"><strong>Note</strong>: Actors may write to and read from channels other than their own mailbox. In fact, actors can do whatever regular fibers&nbsp;can.</p>

<h3 id="creating-actors">Creating&nbsp;Actors</h3>

<p>All actors extends the <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html"><code>Actor</code></a> class. The constructor takes the actor’s name (which does not have to be unique, and may even be <code>null</code>), and its mailbox settings (of type <a href="/quasar/javadoc/co/paralleluniverse/actors/MailboxConfig.html"><code>MailboxConfig</code></a>).</p>

<p><code>MailboxConfig</code> defines the mailbox size (the number of messages that can wait in the mailbox channel), with <code>-1</code> specifying an unbounded mailbox, and an <em>overflow policy</em>. The overflow policy works the same as for plain channels, except that the <code>THROW</code> policy doesn’t cause an exception to be thrown in the sender if the mailbox capacity is exceeded, but rather throws an exception into the receiving actor (the exception will be thrown when the actor next blocks on a&nbsp;<code>recieve</code>).</p>

<p>An actor is required to implement the <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#doRun()"><code>doRun</code></a> method. This method is the actor body, and is run when the actor is&nbsp;spawned.</p>

<p>It is prefereable to subclass <a href="/quasar/javadoc/co/paralleluniverse/actors/BasicActor.html"><code>BasicActor</code></a> rather than <code>Actor</code>; <code>BasicActor</code> provides the ability to perform selective receives (more on that&nbsp;later).</p>

<h3 id="spawning-actors">Spawning&nbsp;Actors</h3>

<p>Actors can run in any strand – fiber or thread, although you’d usually want to run them in fibers. <code>Actor</code> implements <code>SuspendableCallable</code> so you may run it by setting it as the target of a fiber or a thread (via <code>Strand.toRunnable(SuspendableCallable))</code>). A simpler way to start an actor is by&nbsp;calling</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">actor</span><span class="o">.</span><span class="na">spawn</span><span class="o">()</span>
</span></code></pre></div>
<p>which assigns the actor to a newly created fiber and starts it,&nbsp;or</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">actor</span><span class="o">.</span><span class="na">spawnThread</span><span class="o">()</span>
</span></code></pre></div>
<p>which assigns the actor to a newly created thread and&nbsp;starts.</p>

<p>An actor can be <code>join</code>ed, just like a fiber. Calling <code>get</code> on an actor will join it and return the value returned by&nbsp;<code>doRun</code>.</p>

<p class="alert alert-info"><strong>Note</strong>: Just like fibers, spawning an actor is a very cheap operation in both computation and memory. Do not fear creating many (thousands, tens-of-thousands or even hundereds-of-thousands)&nbsp;actors.</p>

<h2 id="sending-and-receiving-messages-actorref">Sending and Receiving Messages,&nbsp;<code>ActorRef</code></h2>

<p>The <code>spawn</code> method returns an instance of <a href="/quasar/javadoc/co/paralleluniverse/actors/ActorRef.html"><code>ActorRef</code></a>. All (almost) interactions with an actor take place through its <code>ActorRef</code>, which can also be obtained by calling <code>ref()</code> on the actor. The <code>ActorRef</code> is used as a level of indirection that provides additional isolation for the actor (and actors are all about isolation). It enables things like hot code swapping and&nbsp;more.</p>

<p><a href="/quasar/javadoc/co/paralleluniverse/actors/ActorRef.html#self()"><code>ActorRef.self()</code></a> is a static function that returns the currently executing actor’s ref, and <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#self()"><code>Actor.self()</code></a> is a protected member function that returns an actor’s ref. Use them to obtain and share an actor’s ref with other&nbsp;actors.</p>

<p class="alert alert-warn"><strong>Note</strong>: An actor must <em>never</em> pass a direct reference to itself to other actors or to be used on other strands. However, it may share its <code>ActorRef</code>&nbsp;freely.</p>

<p>The <code>ActorRef</code> allows sending messages to the actor’s mailbox. In fact, <code>ActorRef</code> implements <code>SendPort</code> so it can be used just like a&nbsp;channel.</p>

<p>An actor receives a message by calling the <a href="/quasar/javadoc/co/paralleluniverse/actors//Actor.html#receive()"><code>recieve</code></a> method. The method blocks until a message is available in the mailbox, and then returns it. <a href="/quasar/javadoc/co/paralleluniverse/actors//Actor.html#receive(long, java.util.concurrent.TimeUnit)">Another version</a> of <code>receive</code> blocks up to a given duration, and returns <code>null</code> if no message is received by that&nbsp;time.</p>

<p>Normally, an actor is implements a loop similar to this&nbsp;one:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nd">@Override</span>
</span><span id="line-2"><span class="kd">protected</span> <span class="n">Void</span> <span class="nf">doRun</span><span class="o">()</span> <span class="o">{</span>
</span><span id="line-3">    <span class="k">for</span><span class="o">(;;)</span> <span class="o">{</span>
</span><span id="line-4">        <span class="n">Object</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">receive</span><span class="o">();</span>
</span><span id="line-5">        <span class="c1">// process message</span>
</span><span id="line-6">        <span class="k">if</span> <span class="o">(</span><span class="n">thatsIt</span><span class="o">())</span>
</span><span id="line-7">            <span class="k">break</span><span class="o">;</span>
</span><span id="line-8">    <span class="o">}</span>
</span><span id="line-9">    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span id="line-10"><span class="o">}</span>
</span></code></pre></div>
<h3 id="actors-vs-channels">Actors vs.&nbsp;Channels</h3>

<p>One of the reasons of providing a different <code>receive</code> function for actors is because programming with actors is conceptually different from just using fibers and channels. I think of channels as hoses pumping data into a function, or as sort of like asynchronous parameters. A fiber may pull many different kinds of data from many different channels, and combine the data in some&nbsp;way. </p>

<p>Actors are a different abstraction. They are more like objects in object-oriented languages, assigned to a single thread. The mailbox serves as the object’s dispatch mechanism; it’s not a hose but a switchboard. It’s for this reason that actors often need to pattern-match their mailbox messages, while regular channels – each usually serving as a conduit for a single kind of data –&nbsp;don’t.</p>

<h3 id="selective-receive">Selective&nbsp;Receive</h3>

<p>An actor is a state machine. It usually encompasses some <em>state</em> and the messages it receives trigger <em>state transitions</em>. But because the actor has no control over which messages it receives and when (which can be a result of either other actors’ behavior, or even the way the <span class="caps">OS</span> schedules threads), an actor would be required to process any message and any state, and build a full <em>state transition matrix</em>, namely how to transition whenever <em>any</em> messages is received at <em>any</em>&nbsp;state.</p>

<p>This can not only lead to code explosion; it can lead to bugs. The key to managing a complex state machine is by not handling messages in the order they arrive, but in the order we wish to process them. If your actor extends <a href="/quasar/javadoc/co/paralleluniverse/actors/BasicActor.html"><code>BasicActor</code></a>, there’s <a href="/quasar/javadoc/co/paralleluniverse/actors/BasicActor.html#receive(co.paralleluniverse.actors.MessageProcessor)">another form</a> of the <code>receive</code> method that allows for <em>selective receive</em>. This method takes an instance of <a href="/quasar/javadoc/co/paralleluniverse/actors/MessageProcessor.html"><code>MessageProcessor</code></a>, which <em>selects</em> messages out of the mailbox (a message is selected iff <code>MessageProcessor.process</code> returns a non-null value when it is passed the message). Alternatively (to extending <code>BasicActor</code>, you can make use of the <a href="/quasar/javadoc/co/paralleluniverse/actors/SelectiveReceiveHelper.html"><code>SelectiveReceiveHelper</code></a>&nbsp;class.</p>

<p>Let’s look at an example. Suppose we have this message&nbsp;class:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="kd">class</span> <span class="nc">ComplexMessage</span> <span class="o">{</span>
</span><span id="line-2">    <span class="kd">enum</span> <span class="n">Type</span> <span class="o">{</span> <span class="n">FOO</span><span class="o">,</span> <span class="n">BAR</span><span class="o">,</span> <span class="n">BAZ</span><span class="o">,</span> <span class="n">WAT</span> <span class="o">}</span>
</span><span id="line-3">    <span class="kd">final</span> <span class="n">Type</span> <span class="n">type</span><span class="o">;</span>
</span><span id="line-4">    <span class="kd">final</span> <span class="kt">int</span> <span class="n">num</span><span class="o">;</span>
</span><span id="line-5">    <span class="kd">public</span> <span class="nf">ComplexMessage</span><span class="o">(</span><span class="n">Type</span> <span class="n">type</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
</span><span id="line-6">        <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
</span><span id="line-7">        <span class="k">this</span><span class="o">.</span><span class="na">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">;</span>
</span><span id="line-8">    <span class="o">}</span>
</span><span id="line-9"><span class="o">}</span>
</span></code></pre></div>
<p>Then, this&nbsp;call:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">ComplexMessage</span> <span class="n">m</span> <span class="o">=</span> <span class="n">receive</span><span class="o">(</span><span class="k">new</span> <span class="n">MessageProcessor</span><span class="o">&lt;</span><span class="n">ComplexMessage</span><span class="o">,</span> <span class="n">ComplexMessage</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span id="line-2">        <span class="kd">public</span> <span class="n">ComplexMessage</span> <span class="nf">process</span><span class="o">(</span><span class="n">ComplexMessage</span> <span class="n">m</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SuspendExecution</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span id="line-3">            <span class="k">switch</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">type</span><span class="o">)</span> <span class="o">{</span>
</span><span id="line-4">            <span class="k">case</span> <span class="nl">FOO:</span>
</span><span id="line-5">            <span class="k">case</span> <span class="nl">BAR:</span>
</span><span id="line-6">                <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
</span><span id="line-7">            <span class="k">default</span><span class="o">:</span>
</span><span id="line-8">                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span id="line-9">            <span class="o">}</span>
</span><span id="line-10">        <span class="o">}</span>
</span><span id="line-11">    <span class="o">});</span>
</span></code></pre></div>
<p>will only return a message whose <code>type</code> value is <code>FOO</code> or <code>BAR</code>, but not <code>BAZ</code>. If a message of type <code>BAZ</code> is found in the mailbox,&nbsp;it
will remain there and be skipped, until it is selcted by a subsequent call to <code>receive</code> (selective or&nbsp;plain).</p>

<p><code>MessageProcessor.process</code> can also process the message inline (rather than have it processed by the caller to <code>receive</code>), and even call a nested&nbsp;`receive:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">doRun</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">SuspendExecution</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span id="line-2">    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span><span id="line-3">    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span id="line-4">        <span class="n">receive</span><span class="o">(</span><span class="k">new</span> <span class="n">MessageProcessor</span><span class="o">&lt;</span><span class="n">ComplexMessage</span><span class="o">,</span> <span class="n">ComplexMessage</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span id="line-5">            <span class="kd">public</span> <span class="n">ComplexMessage</span> <span class="nf">process</span><span class="o">(</span><span class="n">ComplexMessage</span> <span class="n">m</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SuspendExecution</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span id="line-6">                <span class="k">switch</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">type</span><span class="o">)</span> <span class="o">{</span>
</span><span id="line-7">                <span class="k">case</span> <span class="nl">FOO:</span>
</span><span id="line-8">                    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">num</span><span class="o">);</span>
</span><span id="line-9">                    <span class="n">receive</span><span class="o">(</span><span class="k">new</span> <span class="n">MessageProcessor</span><span class="o">&lt;</span><span class="n">ComplexMessage</span><span class="o">,</span> <span class="n">ComplexMessage</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span id="line-10">                        <span class="kd">public</span> <span class="n">ComplexMessage</span> <span class="nf">process</span><span class="o">(</span><span class="n">ComplexMessage</span> <span class="n">m</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SuspendExecution</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span id="line-11">                            <span class="k">switch</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">type</span><span class="o">)</span> <span class="o">{</span>
</span><span id="line-12">                            <span class="k">case</span> <span class="nl">BAZ:</span>
</span><span id="line-13">                                <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">num</span><span class="o">);</span>
</span><span id="line-14">                                <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
</span><span id="line-15">                            <span class="k">default</span><span class="o">:</span>
</span><span id="line-16">                                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span id="line-17">                            <span class="o">}</span>
</span><span id="line-18">                        <span class="o">}</span>
</span><span id="line-19">                    <span class="o">});</span>
</span><span id="line-20">                    <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
</span><span id="line-21">                <span class="k">case</span> <span class="nl">BAR:</span>
</span><span id="line-22">                    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">num</span><span class="o">);</span>
</span><span id="line-23">                    <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
</span><span id="line-24">                <span class="k">default</span><span class="o">:</span>
</span><span id="line-25">                    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span id="line-26">                <span class="o">}</span>
</span><span id="line-27">            <span class="o">}</span>
</span><span id="line-28">        <span class="o">});</span>
</span><span id="line-29">    <span class="o">}</span>
</span><span id="line-30">    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
</span><span id="line-31"><span class="o">}</span>
</span></code></pre></div>
<p>If a <code>FOO</code> is received first, then the next <code>BAZ</code> will be added to the list following the <code>FOO</code>, even if a <code>BAR</code> is found in the mailbox after the <code>FOO</code>, because the nested receive in the <code>case FOO:</code> clause selects only a <code>BAZ</code>&nbsp;message.</p>

<p class="alert alert-info"><strong>Note</strong>: <code>MessageProcessor</code> will become much less cumbersome in Java 8 with the introduction of lambda&nbsp;expressions.</p>

<p>There are several actor systems that do not support selective receive, but Erlang does, and so does Quasar. <a href="http://www.infoq.com/presentations/Death-by-Accidental-Complexity">The talk <em>Death by Accidental Complexity</em></a>, by Ulf Wiger, shows how using selective receive avoids implementing a full, complicated and error-prone transition matrix. <a href="http://www.infoq.com/presentations/1000-Year-old-Design-Patterns">In a different talk</a>, Wiger compared non-selective (<span class="caps">FIFO</span>) receive to a tetris game where you must fit each piece into the puzzle as it comes, while selective receive turns the problem into a jigsaw puzzle, where you can look for a piece that you know will&nbsp;fit.</p>

<p class="alert alert-warn"><strong>A word of caution</strong>: Using selective receive in your code may lead to deadlocks (because you’re essentially saying, I’m going to wait here until a specific message arrives). This can be easily avoided by always specifying a timeout (with the <code>:after millis</code> clause) when doing a selective receive. Selective receive is a powerful tool that can greatly help writing readable, maintainable message-handling code, but don’t over-use&nbsp;it.</p>

<h2 id="error-handling">Error&nbsp;Handling</h2>

<p>The actor model does not only make concurrency easy; it also helps build fault-tolerant systems by compartmentalizing failure. Each actor is it’s own execution context - if it encounters an exception, only the actor is directly affected (like a thread, only actors are lightweight). Unlike regular functions/objects, where an exception has to be caught and handled immediately on the callstack, with actors we can completely separate code execution from error&nbsp;handling.</p>

<p>In fact, when using actors, it is often best to to follow the <a href="http://www.erlang.org/download/armstrong_thesis_2003.pdf">philosophy laid out by Joe Armstrong</a>, Erlang’s chief designer, of “let it crash”. The idea is not to try and catch exceptions inside an actor, because attempting to catch and handle all exceptions is futile. Instead, we just let the actor crash, monitor its death elsewhere, and then take some&nbsp;action.</p>

<p>The principle of actor error handling is that an actor can be asked to be notified of another actor’s death and its cause. This is done through <em>linking</em> or <em>watching</em>. </p>

<h3 id="linking-and-watching-actors">Linking and Watching&nbsp;Actors</h3>

<p><em>Linking</em> two actors causes the death of one to throw an exception in the other. Two actors are linked with the <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#link(co.paralleluniverse.actors.ActorRef)"><code>link</code></a> method of the <code>Actor</code> class, and can be unlinked with the <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#unlink(co.paralleluniverse.actors.ActorRef)"><code>unlink</code></a> method. A link is symmetric: <code>a.link(b)</code> has the exact same effect of <code>b.link(a)</code>. The next section explains in detail how the linking mechanism&nbsp;works.</p>

<p>A more robust way of being notified of actor death than linking is with a <em>watch</em> (called <em>monitor</em> in Erlang; this is one of the few occasions we have abandoned the Erlang function names). To make an actor watch another you use the <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#watch(co.paralleluniverse.actors.ActorRef)"><code>watch</code></a> method. When a watched actor, its watcher actor (or many watching actors) receives an <code>ExitMessage</code>, explained in the next section. Unlike links, watches are asymmetric (if A watches B, B does not necessarily watch A), and they are also composable: the <code>watch</code> method returns a <em>watch-id</em> object that identifies the particular watch; every <code>ExitMessage</code> contains that <em>watch-id</em> object that uniquely identifies the watch that caused the message to be received. If an actor calls the <code>watch</code> method several times with the same argument (i.e. it watches the same actor more than once), a message will be received for each of these different watches. A watch can be undone with the <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#unwatch(co.paralleluniverse.actors.ActorRef, java.lang.Object)"><code>unwatch</code></a>&nbsp;method.</p>

<h3 id="lifecycle-messages-and-lifecycle-exceptions">Lifecycle Messages and Lifecycle&nbsp;Exceptions</h3>

<p>When actor B that is linked to or watched by actor A dies, it automatically sends an <a href="/quasar/javadoc/co/paralleluniverse/actors/ExitMessage.html"><code>ExitMessage</code></a> to A. The message is put in A’s mailbox and retrieved when A calls <code>receive</code> or <code>tryReceive</code>, but it isn’t actually returned by those&nbsp;methods. </p>

<p>When <code>receive</code> (or <code>tryRecive</code>) is called, it takes the next message in the mailbox, and passes it to a protected method called <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#filterMessage(java.lang.Object)"><code>filterMessage</code></a>. Whatever <code>filterMessage</code> returns, that’s the message actually returned by <code>receive</code> (or <code>tryReceive</code>), but it <code>filterMessage</code> returns <code>null</code>, <code>receive</code> will not return and wait for the next message (and <code>tryReceive</code> will check if another message is already available, or otherwise return <code>null</code>). The default implementation of <code>filterMessage</code> always returns the message it received unless it is of type <a href="/quasar/javadoc/co/paralleluniverse/actors/LifecycleMessage.html"><code>LifecycleMessage</code></a>, in which case it passes it to the protected <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#handleLifecycleMessage(co.paralleluniverse.actors.LifecycleMessage)"><code>handleLifecycleMessage</code></a>&nbsp;method.</p>

<p><a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#handleLifecycleMessage(co.paralleluniverse.actors.LifecycleMessage)"><code>handleLifecycleMessage</code></a> examines the message. If it is an <a href="/quasar/javadoc/co/paralleluniverse/actors/ExitMessage.html"><code>ExitMessage</code></a> (which extends <code>LifecycleMessage</code>), it checks to see if it’s been sent as a result of a <em>watch</em> (by testing whether its <a href="/quasar/javadoc/co/paralleluniverse/actors/ExitMessage.html#getWatch()"><code>getWatch</code></a> method returns a non-null value). If it is, it’s silently ignored. But if it’s a result of a <em>linked</em> actor dying (<code>getWatch()</code> returns <code>null</code>), the method throws a <a href="/quasar/javadoc/co/paralleluniverse/actors/LifecycleException.html"><code>LifecycleException</code></a>. This exception is thrown, in turn, by actor A’s call to <code>receive</code> (or <code>tryReceive</code>). You can override <code>handleLifecycleMessage</code> to change this&nbsp;behavior.</p>

<p>If you do not want actor A to die if linked actor B does, you should surround the call to <code>receive</code> or <code>tryReceive</code> with a <code>try {} catch(LifecycleException) {}</code>&nbsp;block.</p>

<p>While you <em>can</em> override the <code>filterMessage</code> or the <code>handleLifecycleMessage</code> method, but will seldom have reason to override the latter, and almost never should override the&nbsp;former.</p>

<h2 id="registering-actors">Registering&nbsp;Actors</h2>

<p><em>Registering</em> an actor gives it a public name that can be used to locate the actor. You register an actor with the <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#register()"><code>register</code></a> method of the <code>Actor</code> class, and unregister with the <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#unregister()"><code>unregister</code></a> method. To find an actor by its name, use the <a href="/quasar/javadoc/co/paralleluniverse/actors/ActorRegistry.html#getActor(java.lang.String)"><code>ActorRegistry.getActor</code></a> static&nbsp;method.</p>

<p>If you’re running Quasar in a cluster configuration (see <a href="cluster.html">Clustering</a>), registering an actor makes it globally available in the cluster. Calling <code>ActorRegistry.getActor</code> on any remote node would return a remote reference to the&nbsp;actor.</p>

<p>In addition, registering an actor automatically sets up monitoring for the actor, as explained in the next&nbsp;section.</p>

<h2 id="monitoring-actors">Monitoring&nbsp;Actors</h2>

<p>All actors running in a <span class="caps">JVM</span> instance are monitored by a <a href="/quasar/javadoc/co/paralleluniverse/actors/ActorsMXBean.html">MXBean</a> registered with the name <code>"co.paralleluniverse:type=Actors"</code>. For details, please consult the <a href="/quasar/javadoc/co/paralleluniverse/actors/ActorsMXBean.html">Javadoc</a>.</p>

<p>In addition, you can create a an <a href="/quasar/javadoc/co/paralleluniverse/actors/ActorMXBean.html">MXBean</a> that monitors a specific actor by calling the actor’s <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#monitor()"><code>monitor</code></a> method. That MBean will be registered as <code>"co.paralleluniverse:type=quasar,monitor=actor,name=ACTOR_NAME"</code>.This happens automatically when an actor is&nbsp;registered.</p>

<p>A monitored actor (either as a result of it being registered or of having called the <code>monitor</code> method) can have its MBean removed by calling the <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#stopMonitor()"><code>stopMonitor</code></a>&nbsp;method.</p>

<h2 id="behaviors">Behaviors</h2>

<p>Erlang’s designers have realized that many actors follow some common patterns - like an actor that receives requests for work and then sends back a result to the requester. They’ve turned those patterns into actor templates, called behaviors, in order to save poeple work and avoid some common errors. Erlang serves as the main inspiration to Quasar Actors, so some of these behaviors have been ported to&nbsp;Quasar. </p>

<h3 id="requestreplyhelper">RequestReplyHelper</h3>

<p>A very common pattern that emerges when working with patterns is request-response, whereby a <em>request</em> message is sent to an actor, and a <em>response</em> is sent back to the sender of the request. While simple, some care must be taken to ensure that the response is matched with the correct&nbsp;request. </p>

<p>This behavior is implemented for you in the <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/RequestReplyHelper.html"><code>RequestReplyHelper</code></a> class (in the <code>co.paralleluniverse.actors.behaviors</code>&nbsp;package). </p>

<p>To use it, the request message must extend <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/RequestMessage.html"><code>co.paralleluniverse.actors.behaviors.RequestMessage</code></a>. Suppose we have a <code>IsDivisibleBy</code> message class that extends <code>RequestMessage</code>. We can interact with a divisor-checking actor like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="n">RequestReplyHelper</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">actor</span><span class="o">,</span> <span class="k">new</span> <span class="n">IsDivisibleBy</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="mi">50</span><span class="o">));</span>
</span></code></pre></div>
<p>And define the actor&nbsp;thus:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">IsDivisibleBy</span><span class="o">&gt;</span> <span class="n">actor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Actor</span><span class="o">&lt;</span><span class="n">IsDivisibleBy</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span id="line-2">    <span class="kd">protected</span> <span class="n">Void</span> <span class="nf">doRun</span><span class="o">()</span> <span class="o">{</span>
</span><span id="line-3">        <span class="k">for</span><span class="o">(;;)</span> <span class="o">{</span>
</span><span id="line-4">            <span class="n">IsDivisibleBy</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">receive</span><span class="o">();</span>
</span><span id="line-5">            <span class="k">try</span> <span class="o">{</span>
</span><span id="line-6">                <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="na">getDivisor</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span>
</span><span id="line-7">                <span class="n">RequestReplyHelper</span><span class="o">.</span><span class="na">reply</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
</span><span id="line-8">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ArithmeticException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span id="line-9">                <span class="n">RequestReplyHelper</span><span class="o">.</span><span class="na">replyError</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span id="line-10">            <span class="o">}</span>
</span><span id="line-11">        <span class="o">}</span>
</span><span id="line-12">    <span class="o">}</span>
</span><span id="line-13"><span class="o">}.</span><span class="na">spawn</span><span class="o">();</span>
</span></code></pre></div>
<p>In the case of an <code>ArithmeticException</code> (if the divisor is 0), the exception will be thrown by&nbsp;<code>RequestReplyHelper.call</code>. </p>

<p>One of the nicest things about the <code>RequestReplyHelper</code> class, is that the code calling <code>call</code> does not have to be an actor. It can be called by a regular thread (or fiber). But if you examine the code of the <code>reply</code> method, you’ll see that it simply sends a response message to the request’s sender, which is an actor. This is achieved by the <code>call</code> method creating a temporary virtual actor, that will receive the reply&nbsp;message.</p>

<h3 id="behavior-actors">Behavior&nbsp;Actors</h3>

<p>Similarly to Erlang, Quasar includes “actor templates” for some common actor behaviors, called <em>behavior actors</em>. Their functionality is separated in two: the implementation, which extends <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/BehaviorActor.html"><code>BehaviorActor</code></a> and standardize handling of standard messages, and the interface, which extends <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/Behavior.html"><code>Behavior</code></a> (which, in turn, extends <code>ActorRef</code>), and includes additional methods to those of <code>ActorRef</code>. It’s important to note that those interface methods do nothing more than assist in the creation and sending of said standard messages to the actor implementation. They employ no new&nbsp;construct.</p>

<p>By itself, <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/BehaviorActor.html"><code>BehaviorActor</code></a> provides handling for <a href="/quasar/javadoc/co/paralleluniverse/actors/ShutdownMessage.html"><code>ShutdownMessage</code></a>, which, as its name suggests, requests an actor to shut itself down, along with the accompanying <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/Behavior.html#shutdown()"><code>shutdown</code></a> method in the <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/Behavior.html"><code>Behavior</code></a> class (the “interface” side). In addition, <code>BehaviorActor</code> defines standard initialization and termination methods which may be overriden. You should consult the <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/BehaviorActor.html">Javadoc</a> for more&nbsp;detail.</p>

<p>When a behavior actor is spawned, its <code>spawn</code> (or <code>spawnThread</code>) method returns its “interface” (which is also an&nbsp;<code>ActorRef</code>).</p>

<p class="alert alert-info"><strong>Note:</strong> Behavior actors usually have different constructors for convenience. Those that do not take an explicit <code>MailboxConfig</code> parameter, use the default configuration of <em>an unbounded mailbox</em>. </p>

<h3 id="server">Server</h3>

<p>The <em>server</em> behavior is an actor that implements a request-reply model. The behavior implementation is found in <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/ServerActor.html"><code>ServerActor</code></a>, and the interface is <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/Server.html"><code>Server</code></a>.</p>

<p>You can implement a server actor by subclassing <code>ServerActor</code> and overriding the some or all of the&nbsp;methods:</p>

<ul>
  <li>init</li>
  <li>terminate </li>
  <li>handleCall</li>
  <li>handleCast</li>
  <li>handleInfo</li>
  <li>handleTimeout</li>
</ul>

<p>or by providing an instance of <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/ServerHandler.html"><code>ServerHandler</code></a> which implements these methods to the <code>ServerActor</code> constructor. Please consult the <code>ServerActor</code> <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/ServerActor.html">JavaDoc</a> for&nbsp;details.</p>

<p>The interface, <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/Server.html"><code>Server</code></a>, adds additional methods to <code>ActorRef</code>, such as <code>call</code> and <code>cast</code>, that allow sending synchronous (a request that waits for a response) or asynchronous (a request that does not wait for a response) requests to the server&nbsp;actor.</p>

<h3 id="eventsource">EventSource</h3>

<p>The event-source behavior is an actor that can be notified of <em>event</em> messages, which are delivered to <em>event handlers</em> which may be registered with the&nbsp;actor.</p>

<p>To create an event source actor, simply construct an instance of the <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/EventSourceActor.html"><code>EventSourceActor</code></a> class. Event handlers are instances of <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/EventHandler.html"><code>EventHandler</code></a>. Event handlers can be registered or unregistered with the actor, and events sent to the actor, through the behavior’s interface, the <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/EventSource.html"><code>EventSource</code></a>&nbsp;class.</p>

<p>Event handlers are called synchronously on the same strand as the actor’s, so they may delay processing by other handlers if they block the&nbsp;strand.</p>

<h2 id="supervisors">Supervisors</h2>

<p>The last behavior actor, the <em>supervisor</em> deserves a chapter of its own, as it’s at the core of the actor model’s error handling&nbsp;philosophy.</p>

<p>Actors provide fault isolation. When an exception occurs in an actor it can only (directly) take down that actor. Actors also provide fault detection and identification. As we’ve seen, other actors can be notified of an actor’s deat, as well as its cause, via watches and&nbsp;links.</p>

<p>Like other behaviors, the <em>supervisor</em> is a behavior that codifies and standardizes good actor practices; in this case: fault handling. As its name implies, a supervisor is an actor that supervises one or more other actors and watches them to detect their death. When a supervised (or <em>child</em>) actor dies, the supervisor can take several pre-configured actions such as restarting the dead actor or killing and restarting all children. The supervisor might also choose to kill itself and <em>escalate</em> the problem, possibly to its own&nbsp;supervisor.</p>

<p>Actors performing business logic, “worker actors”, are supervised by a supervisor actor that detects when they die and takes one of several pre-configured actions. Supervisors may, in turn, be supervised by other supervisors, thus forming a <em>supervision hierarchy</em> that compartmentalizes failure and&nbsp;recovery. </p>

<p>The basic philosophy behind supervisor-based fault handling was named “let it crash” by Erlang’s designer, Joe Armstrong. The idea is that instead of trying to fix the program state after every expected exception, we simply let an actor crash when it encounters an unexcpected condition and “reboot”&nbsp;it.</p>

<p>A supervisors works as follows: it has a number of <em>children</em>, worker actors or other supervisors that are registered to be supervised wither at the supervisor’s construction time or at a later time. Each child has a mode (represented by the <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/Supervisor.ChildMode.html"><code>Supervisor.ChildMode</code></a>&nbsp;class): 
<code>PERMANENT</code>, <code>TRANSIENT</code> or <code>TEMPORARY</code> that determines whether its death will trigger the supervisor’s <em>recovery event</em>. When the recovery event is triggered, the supervisor takes action specified by its <em>restart strategy</em> - represented by the <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/SupervisorActor.RestartStrategy.html"><code>SupervisorActor.RestartStrategy</code></a> class - or it will give up and fail, depending on predefined failure&nbsp;modes. </p>

<p>When a child actor in the <code>PERMANENT</code> mode dies, it will always trigger its supervisor’s recovery event. When a child in the <code>TRANSIENT</code> mode dies, it will trigger a recovery event only if it has died as a result of an exception, but not if it has simply finished its operation. A <code>TEMPORARY</code> child never triggers it supervisor’s recovery&nbsp;event.</p>

<p>A supervisor’s <em>restart strategy</em> determines what it does during a <em>recovery event</em>: A strategy of <code>ESCALATE</code> measns that the supervisor will shut down (“kill”) all its surviving children and then die; a <code>ONE_FOR_ONE</code> strategy will restart the dead child; an <code>ALL_FOR_ONE</code> strategy will shut down all children and then restart them all; a <code>REST_FOR_ONE</code> strategy will shut down and restart all those children added to the suervisor after the dead&nbsp;child.</p>

<p>Children can be added to the supervisor actor either at construction time or later, with <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/Supervisor.html"><code>Supervisor</code></a>’s <code>addChild</code> method. A child is added by passing a <a href="/quasar/javadoc/co/paralleluniverse/actors/behaviors/Supervisor.ChildSpec.html"><code>ChildSpec</code></a> to the supervisor. The <code>ChildSpec</code> contains the means of how to start the actor, usually in the form of an <a href="/quasar/javadoc/co/paralleluniverse/actors/actors/ActorSpec.html"><code>ActorSpec</code></a> (see the <a href="#actor-restarts">next section</a>), or as an already constructed actor; the childs mode; and how many times an actor is allowed to be restarted in a given amount of time. If the actor is restarted too many times within the specified duration, the supervisor gives up and terminates (along with all its children) causing an&nbsp;escalation.</p>

<p>If an actor needs to know the identity of its siblings, it should add them to the supervisor manually (with <code>Supervisor</code>’s <code>addChild</code> method). For that, it needs to know the identity of its supervisor. To do that, you can construct the <code>ActorSpec</code> in the <code>SupervisorActor</code>’s <code>Initializer</code> or in <code>SupervisorActor.init()</code> method (subclass <code>SupervisorActor</code>), pass <code>Actor.self()</code> to the actor’s constructor, and add it to the supervisor with <code>addChild</code>. Alternatively, simply call <code>Actor.self()</code> in the child’s constructor. This works because the children are constructed from specs (provided they have not been constructed by the caller) during the supervisor’s run, so calling <code>Actor.self()</code> anywhere in the construction process would return the&nbsp;supervisor.</p>

<h3 id="actor-restarts">Actor&nbsp;Restarts</h3>

<p>Restarting an actor means construction a new actor and spawning it. That is why the supervisor’s <code>ChildSpec</code> takes an instance of <code>ActorBuilder</code>. Usually, you’ll use <a href="/quasar/javadoc/co/paralleluniverse/actors/actors/ActorSpec.html"><code>ActorSpec</code></a> as the builder instance. Sometimes, however, you’d like to add a running actor to the supervisor, and that is why <code>ChildSpec</code> has a constructor that takes an <code>ActorRef</code>. To restart such actors, the supervisor relies on the fact that <code>ActorRef</code>s to local actors implement <code>ActorBuilder</code>. When requested to build a new actor, they call the old actor’s <a href="/quasar/javadoc/co/paralleluniverse/actors/Actor.html#reinstantiate()"><code>reinstantiate</code></a> method to create a clone of the old&nbsp;actor.</p>

<p>When an actor is restarted, the supervisor takes care to run it on the same type of strand (thread or fiber) as the old&nbsp;actor.</p>
</div>

      <hr>

      <footer>
        <div>
          <div>&copy; 2013, Parallel Universe Software Co.</div>
        </div>
      </footer>

    </div>
  </div>
</div>

<!-- <script src="/quasar/js/prettify/prettify.js"></script> -->
<script src="/quasar/js/jquery.min.js"></script>
<script src="/quasar/bootstrap/js/bootstrap.min.js"></script>
<script src="/quasar/js/bootstrap-scrollspy.js"></script>
<script>


  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25007319-2']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); 
    ga.type = 'text/javascript'; 
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; 
    s.parentNode.insertBefore(ga, s);
  })();


// Change "active" style on selected left-hand navigation menu item.
$(document).ready(function () {
  var path = location.pathname;
  $('ul.nav > li > a[href="' + path + '"]').parent().addClass('active');

  // TODO: Use kramdown {:.prettyprint .linenums .lang-ruby} to add the
  // <pre class="prettyprint"> instead of doing this client-side.

  // $('pre:has(code:not(.language-txt))').addClass('prettyprint');
  // window.prettyPrint && prettyPrint();
});
</script>

</body>
</html>
